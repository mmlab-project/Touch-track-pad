<Window x:Class="GlideDeckReceiver.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        Title="{DynamicResource AppTitle}"
        Width="480" Height="700"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource WindowGlassBrush}"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize"
        Icon="icon.ico"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged">


    <!-- Main Container (no corner radius - using standard window frame) -->
    <Grid Background="{StaticResource WindowGlassBrush}"
          MouseLeftButtonDown="Window_MouseLeftButtonDown">
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Toolbar (Language Button) -->
                <RowDefinition Height="Auto"/> <!-- Tabs -->
                <RowDefinition Height="*"/>    <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Taskbar Icon -->
            <tb:TaskbarIcon x:Name="TrayIcon"
                            IconSource="pack://application:,,,/icon.ico"
                            ToolTipText="{DynamicResource AppTitle}"
                            TrayMouseDoubleClick="TrayIcon_TrayMouseDoubleClick">
                <tb:TaskbarIcon.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Show" Click="MenuItem_Show_Click"/>
                        <Separator/>
                        <MenuItem Header="Exit" Click="MenuItem_Exit_Click"/>
                    </ContextMenu>
                </tb:TaskbarIcon.ContextMenu>
            </tb:TaskbarIcon>

            <!-- Toolbar -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10">
               <!-- Language Switcher -->
               <Button Content="{DynamicResource LanguageSwitch}" 
                       Click="LanguageButton_Click"
                       Style="{StaticResource LiquidButton}" 
                       Background="Transparent" 
                       Foreground="{StaticResource TextSecondaryBrush}"
                       Padding="8,4" FontSize="14"/>
            </StackPanel>

            <!-- Segmented Tabs -->
            <TabControl Grid.Row="1" 
                        Background="Transparent" 
                        BorderThickness="0"
                        Margin="0,0,0,10"
                        ItemContainerStyle="{StaticResource LiquidTabItem}">
                <TabControl.Resources>
                    <Style TargetType="TabPanel">
                        <Setter Property="HorizontalAlignment" Value="Center"/>
                        <Setter Property="Background" Value="#1AFFFFFF"/> <!-- Subtle pill container -->
                    </Style>
                    <!-- Rounded container for the tabs header -->
                    <Style TargetType="Border">
                         <Setter Property="CornerRadius" Value="20"/>
                    </Style>
                </TabControl.Resources>

                <!-- Connection Tab -->
                <TabItem Header="{DynamicResource TabConnection}">
                    <Border Style="{StaticResource GlassPanel}" Margin="20,10,20,20" Padding="0">
                        <Grid Margin="0,20,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- IP Selection -->
                            <StackPanel Grid.Row="0" Margin="20,0,20,20">
                                <TextBlock Text="{DynamicResource LabelAdapter}" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                                <ComboBox x:Name="IpComboBox" Style="{StaticResource GlassComboBox}" SelectionChanged="IpComboBox_SelectionChanged"/>
                            </StackPanel>

                            <!-- QR Code & Status -->
                            <StackPanel Grid.Row="1" HorizontalAlignment="Center">
                                <Border Background="White" CornerRadius="16" Padding="12" HorizontalAlignment="Center" Width="180" Height="180">
                                    <Image x:Name="QrCodeImage" RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                                </Border>
                                
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,16,0,0">
                                    <TextBlock Text="IP: " Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock x:Name="IpText" Foreground="{StaticResource AccentBrush}" FontWeight="Bold"/>
                                    <TextBlock Text="{DynamicResource LabelPort}" Foreground="{StaticResource TextSecondaryBrush}" Margin="8,0,0,0"/>
                                    <TextBlock x:Name="PortText" Foreground="{StaticResource AccentBrush}" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <Button x:Name="RefreshButton" Content="{DynamicResource BtnRefresh}" Style="{StaticResource LiquidButton}" Click="RefreshButton_Click" HorizontalAlignment="Center" Margin="0,16,0,0" Width="160"/>
                            </StackPanel>

                            <!-- Stats Footer -->
                            <StackPanel Grid.Row="2" VerticalAlignment="Bottom" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
                                <Ellipse x:Name="StatusIndicator" Width="8" Height="8" Fill="#34C759" Margin="0,0,8,0">
                                    <Ellipse.Effect>
                                        <DropShadowEffect BlurRadius="4" ShadowDepth="0" Color="#34C759"/>
                                    </Ellipse.Effect>
                                </Ellipse>
                                <TextBlock x:Name="StatusText" Text="{DynamicResource StatusServerRunning}" Foreground="{StaticResource TextBrush}"/>
                                <TextBlock x:Name="ClientCountText" Text="{DynamicResource LabelClients}" Foreground="{StaticResource TextSecondaryBrush}" Margin="8,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </TabItem>

                <!-- Macros Tab -->
                <TabItem Header="{DynamicResource TabMacros}">
                    <Border Style="{StaticResource GlassPanel}" Margin="20,10,20,20" Padding="0">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <ListBox x:Name="MacroList" Grid.Row="0" Background="Transparent" BorderThickness="0" Margin="0,0,0,20" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="16,12" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextBrush}" FontSize="15"/>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border x:Name="Bd" Background="Transparent" CornerRadius="12">
                                                        <ContentPresenter/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource AccentBrush}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="#1AFFFFFF"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>

                            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="{DynamicResource BtnAdd}" Click="AddMacro_Click" Style="{StaticResource LiquidButton}" Margin="0,0,10,0"/>
                                <Button Content="{DynamicResource BtnEdit}" Click="EditMacro_Click" Style="{StaticResource LiquidButton}" Background="{StaticResource SurfaceGlassBrush}" Margin="0,0,10,0"/>
                                <Button Content="{DynamicResource BtnDelete}" Click="DeleteMacro_Click" Style="{StaticResource LiquidButton}" Background="#FF3B30"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Window>
